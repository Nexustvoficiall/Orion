<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‚öΩ Jogos da Rodada - Orion</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<style>
  body {
    background: radial-gradient(circle at center, #1a0033 0%, #0b001a 100%);
    color: white;
    font-family: 'Poppins', sans-serif;
    overflow-x: hidden;
    min-height: 100vh;
    position: relative;
  }

  /* Estrelas suaves animadas */
  .star {
    position: absolute;
    background: white;
    border-radius: 50%;
    opacity: 0.25;
    animation: moveStar linear infinite;
  }

  @keyframes moveStar {
    from { transform: translateY(0); opacity: 0.25; }
    to { transform: translateY(-1000px); opacity: 0; }
  }

  header {
    text-align: center;
    padding: 3rem 1rem 2rem;
    z-index: 10;
    position: relative;
  }

  header img {
    width: 140px;
    margin: 0 auto 1rem;
    filter: drop-shadow(0 0 15px rgba(150, 100, 255, 0.6));
  }

  header h1 {
    font-size: 2.5rem;
    font-weight: bold;
    color: #b694ff;
    text-shadow: 0 0 10px #7b4eff, 0 0 25px #3f1b8a;
  }

  header p, #rodada {
    color: #bfaeff;
    font-size: 1.1rem;
    margin-top: 0.5rem;
  }

  /* Bot√µes de ligas */
  .liga-btn {
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(255,255,255,0.2);
    backdrop-filter: blur(8px);
    color: white;
    transition: all 0.3s ease;
  }

  .liga-btn:hover, .liga-btn.active {
    background: rgba(255,255,255,0.25);
    transform: scale(1.05);
  }

  /* Cards dos jogos */
  .card-jogo {
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.15);
    backdrop-filter: blur(10px);
    border-radius: 1rem;
    padding: 1rem 1.5rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: all 0.3s;
  }

  .card-jogo:hover {
    background: rgba(255,255,255,0.12);
    transform: scale(1.02);
  }

  footer {
    text-align: center;
    margin-top: 3rem;
    padding: 2rem 1rem;
    border-top: 1px solid rgba(255,255,255,0.1);
    font-size: 0.875rem;
    color: #aaa6ff;
  }

  /* ==================== SIDEBAR ==================== */
  .sidebar {
    height: 100%;
    width: 250px;
    position: fixed;
    top: 0;
    left: -250px;
    background: linear-gradient(180deg, #1e0b3a, #2e1065, #3b0764);
    padding-top: 60px;
    transition: left 0.3s ease;
    z-index: 100;
    overflow-y: auto;
  }

  .sidebar.active { left: 0; }

  .sidebar a {
    display: block;
    color: white;
    padding: 15px 30px;
    text-decoration: none;
    font-size: 1.1em;
    transition: background 0.2s;
  }

  .sidebar a:hover { background: rgba(147, 51, 234, 0.2); }

  /* SE√á√ÉO IMPORTANTE - COMPACTA */
  .sidebar-importante {
    background: linear-gradient(135deg, rgba(168, 85, 247, 0.15), rgba(99, 102, 241, 0.15));
    border-top: 1px solid rgba(168, 85, 247, 0.3);
    border-bottom: 1px solid rgba(168, 85, 247, 0.3);
    margin: 10px 0;
    padding: 15px 20px;
  }

  .importante-header {
    font-size: 0.85rem;
    font-weight: 800;
    color: #a855f7;
    text-align: center;
    margin-bottom: 12px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .importante-section {
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 1px solid rgba(168, 85, 247, 0.15);
  }

  .importante-section:last-child {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
  }

  .importante-label {
    display: block;
    font-size: 0.75rem;
    font-weight: 700;
    color: #c084fc;
    margin-bottom: 8px;
  }

  .logo-preview {
    width: 100%;
    height: 60px;
    background: rgba(10, 10, 30, 0.4);
    border: 1px dashed rgba(168, 85, 247, 0.3);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 8px;
    overflow: hidden;
  }

  .btn-upload-logo, .btn-salvar-whatsapp {
    width: 100%;
    background: linear-gradient(90deg, #a855f7, #6366f1);
    color: white;
    border: none;
    padding: 8px;
    border-radius: 6px;
    font-weight: 700;
    font-size: 0.75rem;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .btn-upload-logo:hover, .btn-salvar-whatsapp:hover {
    background: linear-gradient(90deg, #6366f1, #a855f7);
    transform: translateY(-1px);
    box-shadow: 0 4px 15px rgba(168, 85, 247, 0.5);
  }

  .btn-upload-logo:disabled {
    background: #555;
    cursor: not-allowed;
    opacity: 0.5;
  }

  .upload-info, .upload-reset {
    font-size: 0.65rem;
    color: #d8b4fe;
    margin-top: 4px;
    text-align: center;
  }

  .upload-info span, .upload-reset span {
    color: #a855f7;
    font-weight: 700;
  }

  .whatsapp-input {
    width: 100%;
    background: rgba(10, 10, 30, 0.4);
    border: 1px solid rgba(168, 85, 247, 0.3);
    border-radius: 6px;
    padding: 8px;
    color: white;
    font-size: 0.8rem;
    margin-bottom: 8px;
    transition: all 0.3s ease;
  }

  .whatsapp-input:focus {
    outline: none;
    border-color: #a855f7;
    box-shadow: 0 0 8px rgba(168, 85, 247, 0.3);
  }

  .whatsapp-input::placeholder {
    color: #888;
    font-size: 0.75rem;
  }
  
  .sidebar-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
    z-index: 100;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
  }
  
  .sidebar-overlay.active {
    opacity: 1;
    pointer-events: auto;
  }

  #menu-toggle {
    position: fixed;
    top: 15px;
    left: 15px;
    background: linear-gradient(90deg, #9333ea, #a855f7);
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 10px;
    cursor: pointer;
    z-index: 101;
    font-weight: bold;
    box-shadow: 0 0 10px rgba(168, 85, 247, 0.6);
    transition: all 0.25s ease;
  }

  #menu-toggle:hover {
    transform: scale(1.05);
    box-shadow: 0 0 20px rgba(168, 85, 247, 0.8);
  }
</style>
</head>
<body>

<button id="menu-toggle">‚ò∞ MENU</button>

<div class="sidebar-overlay" id="sidebarOverlay"></div>
<div class="sidebar" id="sidebar">
  <!-- MENU NAVEGA√á√ÉO -->
  <a href="home.html">üè† In√≠cio</a>
  
  <!-- SE√á√ÉO IMPORTANTE -->
  <div class="sidebar-importante">
    <div class="importante-header">‚≠ê IMPORTANTE</div>
    
    <!-- Upload de Logo -->
    <div class="importante-section">
      <label class="importante-label">üì∏ Logo Personalizada</label>
      <div class="logo-preview" id="logoPreview">
        <img id="logoPreviewImg" src="" alt="Logo" style="display: none; max-width: 100%; max-height: 60px; object-fit: contain;">
        <span id="logoPlaceholder" style="color: #888; font-size: 0.8rem;">Nenhuma logo</span>
      </div>
      <input type="file" id="logoUpload" accept="image/*" style="display: none;">
      <button class="btn-upload-logo" id="btnUploadLogo">Enviar Logo</button>
      <div class="upload-info" id="uploadInfo"><span id="uploadsRestantes">--</span>/2 uploads</div>
      <div class="upload-reset" id="uploadReset">Reset: <span id="dataReset">--/--</span></div>
    </div>

    <!-- WhatsApp -->
    <div class="importante-section">
      <label class="importante-label">üì± WhatsApp</label>
      <input type="tel" id="whatsappInput" class="whatsapp-input" placeholder="(00) 00000-0000" maxlength="15">
      <button class="btn-salvar-whatsapp" id="btnSalvarWhatsapp">Salvar</button>
    </div>
  </div>
  
  <a href="futebol.html">‚öΩ Gerar Esportes</a>
  <a href="esportes.html">üì¢ Banners de Divulga√ß√£o</a>
  <a href="vods.html">üé¨ Filmes & S√©ries</a>
  <a href="videos.html">üé• V√≠deos de Vods</a>
  <a href="programacao.html">üìÖ Programa√ß√£o Esportiva</a>
  <a href="perfil.html">üë§ Meu Perfil</a>
  <a href="#" id="sidebar-logout">üö™ Sair</a>
</div>

<script>
  // Estrelas
  for(let i=0;i<150;i++){
    const star=document.createElement('div');
    star.className='star';
    const size=Math.random()*2+1;
    star.style.width=size+'px';
    star.style.height=size+'px';
    star.style.top=Math.random()*window.innerHeight+'px';
    star.style.left=Math.random()*window.innerWidth+'px';
    star.style.animationDuration=(Math.random()*20+10)+'s';
    document.body.appendChild(star);
  }
</script>

<header>
  <img src="/images/logo.png" alt="Orion Logo">
  <h1>‚öΩ Jogos da Rodada</h1>
  <p>üåå Explore os confrontos e resultados do universo Orion!</p>
  <div id="rodada"></div>
</header>

<div class="flex flex-wrap justify-center gap-3 relative z-10">
  <button class="liga-btn px-4 py-2 rounded-full" data-league="BSA">üáßüá∑ S√©rie A</button>
  <button class="liga-btn px-4 py-2 rounded-full" data-league="PL">üè¥ Premier League</button>
  <button class="liga-btn px-4 py-2 rounded-full" data-league="BL1">üá©üá™ Bundesliga</button>
  <button class="liga-btn px-4 py-2 rounded-full" data-league="PD">üá™üá∏ La Liga</button>
  <button class="liga-btn px-4 py-2 rounded-full" data-league="SA">üáÆüáπ Serie A</button>
  <button class="liga-btn px-4 py-2 rounded-full" data-league="CL">üèÜ Champions League</button>
</div>

<main class="max-w-3xl mx-auto mt-8 px-4 relative z-10">
  <div id="jogos-hoje" class="grid gap-4"></div>
</main>

<footer>
  ¬© 2025 Orion Creator ‚Äî Todos os direitos reservados
</footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getDatabase, ref, get, child, update } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

  // Configura√ß√£o Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyCJU2wA6lL4aglQIzPrlyYdl_5xaIZqIec",
    authDomain: "orion-lab-a9298.firebaseapp.com",
    projectId: "orion-lab-a9298",
    storageBucket: "orion-lab-a9298.firebasestorage.app",
    messagingSenderId: "421847499235",
    appId: "1:421847499235:web:5c271435a1c9d2fe58a0d6",
    databaseURL: "https://orion-lab-a9298-default-rtdb.firebaseio.com/"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  // ==================== GERENCIAMENTO DE LOGO E WHATSAPP ====================
  let userLogoUrl = null;
  let userWhatsapp = null;

  // Fun√ß√£o para atualizar contador de uploads
  async function atualizarContadorUploads(uid) {
    try {
      const dbRef = ref(db);
      const snapshot = await get(child(dbRef, "usuarios/" + uid));
      
      if (snapshot.exists()) {
        const dados = snapshot.val();
        const uploadsRestantes = dados.uploads_restantes || 2;
        const dataReset = dados.data_reset_logo ? new Date(dados.data_reset_logo) : null;
        
        document.getElementById('uploadsRestantes').textContent = uploadsRestantes;
        
        if (dataReset) {
          document.getElementById('dataReset').textContent = dataReset.toLocaleDateString('pt-BR');
        }
        
        // Desabilitar bot√£o se n√£o tiver uploads restantes
        const btnUpload = document.getElementById('btnUploadLogo');
        if (uploadsRestantes <= 0) {
          btnUpload.disabled = true;
          btnUpload.textContent = 'Limite Atingido';
        } else {
          btnUpload.disabled = false;
          btnUpload.textContent = 'Enviar Logo';
        }
        
        // Carregar logo do usu√°rio (logo_url √© o base64)
        const logoImg = document.getElementById('logoPreviewImg');
        const logoPlaceholder = document.getElementById('logoPlaceholder');
        
        if (dados.logo_url) {
          userLogoUrl = dados.logo_url;
          if (logoImg) {
            logoImg.src = dados.logo_url;
            logoImg.style.display = 'block';
          }
          if (logoPlaceholder) {
            logoPlaceholder.style.display = 'none';
          }
          console.log('‚úÖ Logo carregada do Firebase:', dados.logo_url.substring(0, 50) + '...');
        } else {
          // Sem logo personalizada
          if (logoImg) logoImg.style.display = 'none';
          if (logoPlaceholder) {
            logoPlaceholder.style.display = 'block';
            logoPlaceholder.textContent = 'Nenhuma logo';
          }
          console.log('‚ÑπÔ∏è Usu√°rio n√£o possui logo personalizada');
        }
        
        // Mostrar WhatsApp se existir
        if (dados.whatsapp) {
          userWhatsapp = dados.whatsapp;
          document.getElementById('whatsappInput').value = dados.whatsapp;
        }
      }
    } catch (error) {
      console.error('‚ùå Erro ao carregar dados do usu√°rio:', error);
    }
  }

  // Fun√ß√£o para resetar contador mensalmente
  async function verificarResetMensal(uid) {
    const dbRef = ref(db);
    const snapshot = await get(child(dbRef, "usuarios/" + uid));
    
    if (snapshot.exists()) {
      const dados = snapshot.val();
      const dataReset = dados.data_reset_logo ? new Date(dados.data_reset_logo) : null;
      const hoje = new Date();
      
      // Se n√£o tem data de reset ou passou de 30 dias, reseta
      if (!dataReset || hoje >= dataReset) {
        const proximoReset = new Date();
        proximoReset.setDate(proximoReset.getDate() + 30);
        
        await update(ref(db, "usuarios/" + uid), {
          uploads_restantes: 2,
          data_reset_logo: proximoReset.toISOString()
        });
        
        atualizarContadorUploads(uid);
      }
    }
  }

  // Upload de logo
  document.getElementById('btnUploadLogo').addEventListener('click', () => {
    document.getElementById('logoUpload').click();
  });

  document.getElementById('logoUpload').addEventListener('change', async (e) => {
    const file = e.target.files[0];
    if (!file) return;
    
    if (!auth.currentUser) {
      alert('Fa√ßa login novamente!');
      return;
    }
    
    const uid = auth.currentUser.uid;
    
    // Verificar uploads restantes
    const dbRef = ref(db);
    const snapshot = await get(child(dbRef, "usuarios/" + uid));
    const dados = snapshot.val();
    const uploadsRestantes = dados.uploads_restantes || 2;
    
    if (uploadsRestantes <= 0) {
      alert('Voc√™ atingiu o limite de 2 uploads por m√™s. Aguarde o reset em ' + new Date(dados.data_reset_logo).toLocaleDateString('pt-BR'));
      return;
    }
    
    // Validar arquivo
    if (!file.type.startsWith('image/')) {
      alert('Por favor, envie apenas imagens!');
      return;
    }
    
    if (file.size > 5 * 1024 * 1024) {
      alert('A imagem deve ter no m√°ximo 5MB!');
      return;
    }
    
    // Converter para base64
    const reader = new FileReader();
    reader.onload = async (event) => {
      const logoBase64 = event.target.result;
      
      try {
        // Salvar no Firebase Database
        await update(ref(db, "usuarios/" + uid), {
          logo_url: logoBase64,
          uploads_restantes: uploadsRestantes - 1
        });
        
        // Atualizar preview
        const logoImg = document.getElementById('logoPreviewImg');
        const logoPlaceholder = document.getElementById('logoPlaceholder');
        
        logoImg.src = logoBase64;
        logoImg.style.display = 'block';
        if (logoPlaceholder) {
          logoPlaceholder.style.display = 'none';
        }
        userLogoUrl = logoBase64;
        
        alert('Logo enviada com sucesso! Uploads restantes: ' + (uploadsRestantes - 1));
        atualizarContadorUploads(uid);
      } catch (error) {
        console.error('Erro ao salvar logo:', error);
        alert('Erro ao salvar logo. Tente novamente.');
      }
    };
    reader.readAsDataURL(file);
  });

  // Salvar WhatsApp
  document.getElementById('btnSalvarWhatsapp').addEventListener('click', async () => {
    if (!auth.currentUser) {
      alert('Fa√ßa login novamente!');
      return;
    }
    
    const whatsapp = document.getElementById('whatsappInput').value.trim();
    
    if (!whatsapp) {
      alert('Por favor, insira um n√∫mero de WhatsApp!');
      return;
    }
    
    // Valida√ß√£o b√°sica
    const whatsappLimpo = whatsapp.replace(/\D/g, '');
    if (whatsappLimpo.length < 10 || whatsappLimpo.length > 11) {
      alert('N√∫mero de WhatsApp inv√°lido! Use o formato: (00) 00000-0000');
      return;
    }
    
    try {
      const uid = auth.currentUser.uid;
      await update(ref(db, "usuarios/" + uid), {
        whatsapp: whatsapp
      });
      
      userWhatsapp = whatsapp;
      alert('WhatsApp salvo com sucesso!');
    } catch (error) {
      console.error('Erro ao salvar WhatsApp:', error);
      alert('Erro ao salvar WhatsApp. Tente novamente.');
    }
  });

  // M√°scara para WhatsApp
  document.getElementById('whatsappInput').addEventListener('input', (e) => {
    let value = e.target.value.replace(/\D/g, '');
    
    if (value.length <= 11) {
      if (value.length <= 2) {
        e.target.value = value;
      } else if (value.length <= 7) {
        e.target.value = `(${value.slice(0, 2)}) ${value.slice(2)}`;
      } else {
        e.target.value = `(${value.slice(0, 2)}) ${value.slice(2, 7)}-${value.slice(7, 11)}`;
      }
    }
  });

  // Verifica autentica√ß√£o e carrega dados do usu√°rio
  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.href = "index.html";
      return;
    }
    
    // Verificar e resetar contador mensal
    await verificarResetMensal(user.uid);
    
    // Atualizar informa√ß√µes de logo e WhatsApp
    await atualizarContadorUploads(user.uid);
  });

  // Logout
  document.getElementById("sidebar-logout").addEventListener("click", async () => {
    await signOut(auth);
    window.location.href = "index.html";
  });
  
  // Toggle Menu Sidebar com overlay
  const menuToggle = document.getElementById("menu-toggle");
  const sidebar = document.getElementById("sidebar");
  const sidebarOverlay = document.getElementById("sidebarOverlay");
  
  function toggleMenu() {
    sidebar.classList.toggle("active");
    sidebarOverlay.classList.toggle("active");
    document.body.style.overflow = sidebar.classList.contains("active") ? "hidden" : "";
  }
  
  menuToggle.addEventListener("click", toggleMenu);
  sidebarOverlay.addEventListener("click", toggleMenu);
  
  // Fechar ao clicar em link
  sidebar.querySelectorAll("a").forEach(link => {
    link.addEventListener("click", () => {
      if (window.innerWidth <= 768) toggleMenu();
    });
  });
</script>

<script>
const jogosContainer = document.getElementById('jogos-hoje');
const rodadaEl = document.getElementById('rodada');
const botoesLiga = document.querySelectorAll('.liga-btn');

const statusPT = {
  "SCHEDULED": "Agendado",
  "LIVE": "Ao Vivo",
  "IN_PLAY": "Em Andamento",
  "PAUSED": "Pausado",
  "FINISHED": "Finalizado",
  "POSTPONED": "Adiado",
  "CANCELLED": "Cancelado"
};

async function carregarJogos(leagueCode='BSA'){
  jogosContainer.innerHTML = '<p class="text-center text-purple-300 animate-pulse">üîÑ Carregando jogos...</p>';
  rodadaEl.textContent='';

  try{
    const res = await fetch(`/api/jogos?league=${leagueCode}`);
    const data = await res.json();

    if(!data.matches || data.matches.length===0){
      jogosContainer.innerHTML='<p class="text-center text-gray-400">‚ö†Ô∏è Nenhum jogo encontrado para esta rodada.</p>';
      return;
    }

    if(data.matchday) rodadaEl.textContent=`Rodada ${data.matchday}`;

    jogosContainer.innerHTML='';
    data.matches.forEach(jogo=>{
      const dataJogo = new Date(jogo.utcDate || jogo.date);
      const dia = dataJogo.toLocaleDateString('pt-BR', { weekday:'short', day:'2-digit', month:'2-digit' });
      const hora = dataJogo.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'});
      const status=statusPT[jogo.status]||jogo.status;

      const card=`
      <div class="card-jogo">
        <div class="text-center font-semibold">${jogo.homeTeam.name}</div>
        <div class="text-center">
          <span class="text-lg font-bold">${dia} ${hora}</span>
          <p class="text-sm text-gray-300">${status}</p>
        </div>
        <div class="text-center font-semibold">${jogo.awayTeam.name}</div>
      </div>`;
      jogosContainer.innerHTML+=card;
    });

  }catch(err){
    console.error(err);
    jogosContainer.innerHTML='<p class="text-center text-red-400">‚ùå Erro ao carregar dados da API.</p>';
  }
}

// Liga padr√£o
carregarJogos();

botoesLiga.forEach(botao=>{
  botao.addEventListener('click',()=>{
    botoesLiga.forEach(b=>b.classList.remove('active'));
    botao.classList.add('active');
    carregarJogos(botao.dataset.league);
  });
});
</script>
</body>
</html>
